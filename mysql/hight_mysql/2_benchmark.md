MySQL基准测试
===============

基准测试（benchmark）是针对系统设计的一种压力测试。目标是掌握系统的行为，评估系统的容量，掌握哪些是重要的变化，观察系统如何处理不同的数据。此外还可以重现某个系统状态，或者做新硬件的可靠性测试。

为什么需要基准测试
--------------------

    * 验证基于系统的一些假设，确认假设是否符合实际情况；
    * 重现系统中的某些异常行为，以解决这些异常；
    * 测试系统当前运行情况，这是优化的基础；
    * 模拟当前系统更高的负载，找出系统随着压力增加而可能遇到的扩展性瓶颈；
    * 规划未来的业务增长；
    * 测试应用适应可变环境的能力，发现系统在并发峰值下的性能表现，或者在不同配置服务器之间的性能表现，测试系统对不同数据分布的处理能力；
    * 测试不同的硬件、软件和操作系统配置；
    * 证明新设备是否配置正确；

基准测试的策略
---------------

基准测试的两个策略
    * 整体测试，即集成式（full-stack）
    * 单独测试，即单组件测试（single-component）

整体测试的目的
    * 测试整个应用系统，包括Web服务器、应用代码、网络和数据库，了解整体的性能；
    * MySQL并非总是应用的瓶颈，整体测试可以揭示或验证瓶颈；
    * 发现各部分之间的缓存带来的影响；
    * 揭示应用的真实表现；
    * 整体测试是组件测试的基础；

MySQL测试
    * 比较不同的schema或查询的性能；
    * 针对应用中某个具体问题的测试；
    * 避免漫长的基准测试，可以通过一个短期的基准测试，做快速的“周期循环”，检测出某些调整后的效果；

基准测试要测试的指标
    * 吞吐量，单位时间内的事务处理数；主要针对在线事务处理(OLTP)的吞吐量，测试单位是每秒事务数(TPS)或每分钟事务数(TPM)；
    * 响应时间或延迟，测试事务所需的整体时间，由此算出平均响应时间、最小响应时间、最大响应时间和所占百分比；通常可以使用百分比响应时间(percentile response time)代替最大响应时间；
    * 并发性，多少用户在同一时间浏览一个Web站点，即多少个会话，并不等同于Web服务器的并发性，Web服务器的并发性不等同于MySQL的并发性，仅仅表示会话存储机制可以处理多少数据的能力；Web服务器的并发性应该是在任意时间有多少同时发生的并发请求；注意区别Web的并发和MySQL并发的区别和关系，不要将创建数据库连接和并发搞混淆；并发性基准测试关注的是正在工作中的并发操作，或者是同时工作中的线程数或连接数；测试通常不是为了测试应用能达到的并发度，而是为了测试应用在不同并发下的性能；
    * 可扩展性，系统增加一倍的工作，理想情况下，就能获得两倍的结果，或者系统增加一倍的资源，就可以获得两倍的吞吐量；

基准测试工具
-------------

集成式测试工具
    * ab，Apache HTTP服务器基准测试工具，可以测试HTTP服务器美妙最多可以处理多少请求，使用简单，但功能也有限；
    * http_load，跟ab类似，比ab更加灵活，通过输入文件提供多个URL，然后随机选择进行测试；
    * JMeter，Java应用程序，可以加载其他应用并测试其性能；

但组件式测试工具
    * mysqlslap，模拟服务器的负载，输出计时信息，可以执行并发连接数，可以指定SQL语句，不指定时，工具会自动生成查询SELECT语句；
    * MySQL Benchmark Suite(sql-bench)，用于在不同数据库服务器上进行比较测试，测试服务器执行查询的速度，显示哪种类型的操作在服务器上执行得更快；
    * Super Smack，可以提供压力测试和负载生成，可以模拟多用户访问，可以加载测试数据到数据库，支持使用随机数填充测试表；
    * Database Test Suite；
    * Percona's TPCC-MySQL Tool，评估大压力下MySQL的一些行为；
    * sysbench，多线程系统测试工具，根据影响数据库服务器性能的各种因素来评估系统的性能，如测试文件I/O，操作系统调度器、内存分配和传输速度、POSIX线程等；
