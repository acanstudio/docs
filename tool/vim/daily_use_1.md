常用操作
===========

编辑多个文件
---------------

如果要是在当前窗口编辑另一个文件最简单的办法就是:e xxx.txt，这样做有个缺点就是前一个窗口会关闭，而且如果那个文件修改后还没保存，那么还会发出警告，提示是否强制退出。 如果想编辑新的文件，但是又不想放弃当前的文件，那么你可以先把他变为一个隐藏的缓冲区：:hide e xxx2.txt，xxx2.txt保存退出后，按ENTER又会回到上一个文件来，需要说明的话，如果hide的文件没有修改或修改已经保存，则依然会直接退出。

启动vim时，可以同时打开多个文件：vim a.py b.py c.py ，窗口会显示一个文件，如果想切换到b.py文件，可以用命令：:next，前提是当前的这个文件需要先保存，你也可以用:next!强制切换到b.py，放弃当前的保存工作。向前切换使用:previous,规则与next一样。

其他相似命令：

:last
:first
:wnext
:2next:
:wprevious

不言而喻，很直白。

:args：查看vim打开了哪些文件，当前编辑的是哪个文件。打开另一组文件列表：:args a.java b.java c.java
因为这些文件都是在同一个session中，所以，从a文件中yy（yank复制)一行p（paste)到b文件是没问题的。

替换
-----

vim可以借用正则表达式来实现丰富的替换功能，她的基本语法是：
:[addr]s/源字符串/目的字符串/[option]，我们可以看出addr和option是可以缺省不填的，他们各个字段的意思是：

    [addr]代表检索范围，缺省表示当前行，1，10表示1到10行，%代表整个文件等价于1,$，而.,$代表当前行到文件末尾
    s代表替换的意思
    option代表操作类型，缺省只对第一个匹配的字符进行替换，g代表全局替换,c代表操作时确认，gc可以组合使用

以下提供几个例子.

:s/aa/bb/g       将光标所在行出现的所有包含 aa 的字符串中的 aa 替换为 bb
:%s/aa/bb/g      将文档中出现的所有包含 aa 的字符串中的 aa 替换为 bb
:12,23s/aa/bb/g  将从12行到23行中出现的所有包含 aa 的字符串中的 aa 替换为 bb
:%s/^/#/         全文的行首加入 # 字符,批量注释的时候非常有用
:%s= *$==        将所有行尾多余的空格删除
:g/^$/d          这里的g表示对文章中所有符合要求字符串执行替换操作，^表示行首,$表示行尾，整个意思是：将所有的空行删除.

上一篇主要讲解了Vim的翻页（整页，半页，往上，往下），移动（单词，在一行中），拷贝（主要是y的各种组合）删除（主要是d的各种组合），今天主要简要讲解一下vim的配置（直接在当前session中通过命令配置）以及简单的搜索功能。
配置

注：以下配置只能在当前vim窗口（Session）中生效，以后我们再了解如何在把这些设置写入配置文件中。

:set filetype=python   #设置默认语言
:set tabstop=4   #设置tab默认为4个空格
：set nu     #vim窗口左侧显示行号
：set ruler  #在vim窗口显示当前光标位置

如果是撤销以上配置，只需在命令前加no即可，如：:set nonu 就是取消显示行号
撤销恢复

vim本身提供了一个vimtutor的命令，旨在为用户练习，可以随意操作，在终端输入vimtotur en就能打开英文的文本界面。

    撤销工作：u（前提是在normal模式下）怎么确定当前的操作是不是normal呢，按一下esc键，如果不确定是否已经是normal，那就多按几下esc。 如果发现自己撤销的时候撤销过了头，那么ctrl +r 就可以实现重做
    命令计数器： 前面知道了翻页的操作，那么我想具体的往上或往下移动那个光标呢，那么你可以使用命令计数器来实现，如果我要向上移动8行，那么直接8k就ok了。
    写程序时经常会寻找匹配的括号，用%就是实现该效果。

光标移动，以及一些基本的文本操作命令。
---------------------------------------

<pre>
CTRL+f：向下翻一页
CTRL+b：向上翻一页
CTRL+d：向下翻半页
CTRL+u：向上翻半页

// w和W的区别，w会把一个单词理解成由连续的字母或数字或特殊字符，而W却以空格来识别是否到了下一个单词
w：移动到下一个单词的起始处（既然是w，代表的意思就是word，好记吧）
W：移动到下一个单词的起始处
b：移动到前一个单词的起始处
B：移动到前一个单词的起始处（b和B的区别与w和W是同理的）

// 光标在一行内的移动
0：移动到行首
$：移动到行未
^：移动到当前行的第一个非空字符处（如果该行首没有空格，那么效果与0是一样的）
g_：移动到当前行的最后一个非空格字符处

// 插入，追加字符
i：在当前光标位置插入字符
o：在当前行往下插入新的一空行
O：在当前行往上插入新的一空行
a：在当前光标后追加字符
R：替换当前光标的字符直到推出插入模式（按ESC）
:r filename：把文件名为filename的内容插入当当前行的下一行
:r! command：把command返回的结果插入到当前行的下一行

// 拷贝一个单词、行首、行尾、整行
yw：拷贝当前的一个单词
y0：拷贝的范围是当前光标处到行首
y$：拷贝的范围是当前光标处到行尾
yy：拷贝当前行
nyy：从当前行开始拷贝n行（这里的n是数字）

拷贝完后用p就可以粘贴了。
删除一个单词，行首、行尾、整行

x：删除当前光标处字符（严格来说x不属于插入，因为你还要按i才能插入）
dw：删除当前光标出一个单词
d0：删除光标处到行首的字符
d$：删除光标处到行尾的字符
dd：删除整行
ndd：删除n行（同样n代表数字）                                                    </pre>

c命令
------

命令C,他的基本功能是：删除--->剪切---->进入插入模式

c命令详解：

<pre>
# 表示修改当前行上光标后面的部分. 进入编辑状态.
C or c$

# 表示从光标处到当前行行首的部分进行修改，^代表首个非空格处。
c0 or c^

# 修改当前行. 进入编辑状态.
cc OR S

# 从光标所在的位置开始到该单词结束进行修改. 进入编辑状态
cw

# 这里的 x 为一任意字符, cfx 表示修改从光标到下一个字符 x 之间的文本;
# cFx 表示修改从光标到上一个字符 x 之间的文本.
cfx AND cFx

# 修改从光标到当前行的第 n 个字符间的所有字符, n 正整数.
cn|

# 这里的 n 为一任意自然数, cnG 表示修改当前行到第 n 行之间的所有行;
# cG 表示修改当前行直至末行. 
cnG and cG
</pre>

c 命令所删除的数据都存在缓冲区, 可以结合p/P命令构成剪切粘贴操作, 方法是: 先进行 c 命令, 再按 Esc 键返回命令模式, 最后才进行 p/P 命令.

Vim常用的命令
-----------------------------

自从70年代起，Vi就是程序员最好的朋友之一既是你是Vi菜鸟都无所谓，这里为你准备了100条实用的命令列表，以主题的形式组织，他们能让你的代码生活更美好。今天就来点纯练手的东西吧，以后再每个专题说说

<pre>
# 基本命令
:e filename   打开文件编辑
:w    保存
:q    退出Vim
:w!    保存文件退出Vim

# 搜索
/word    从顶部往底部搜索word
?word    从底部往顶部搜索word 
/jo[ha]n       搜索john或joan
/\<the        搜索the或theatre 或then（只要是the开头就行）
/the\>         搜索the或breathe（只要是the结尾就行）
/\<the\>      只搜索the
/\<....\>     搜索长度为4个字符的字符串
/fred\|joe     搜fred或joe
/\<\d\d\d\d\>  搜索4位数字的字符串
/^\n\{3}       查找3个空行的地方
:bufdo /searchstr/    在所有打开的（缓冲区）文件中搜索searchstr
:bufdo %s/pattern/replace/ge | update   所有文件中替换

# 替换
:%s/old/new/g          用new替换文件中出现的所有old
:%s/old/new/gc         与上面这条的作用一样，只不过每替换一个就要确认一次
:2,35s/old/new/g       用new替换2到35行的new
:5,$s/old/new/g        替换4行之后所有old
:%s/^/hello/g          用hello替换所有行首，相当于在行首插入hello
:%s/$/Harry/g          在所有行末加入Harray
:%s/onward/forward/gi  用forward替换onward，忽略大小写
:%s/ *$//g         删除所有行末的空格
:%s/^ *//g         删除所有行首的空格
:g/string/d        删除所有出现有string的行
:v/string/d        删除所有不包含string的行
:s/Bill/Steve/     用Steve替换当前行首次出现的Bill
:s/Bill/Steve/g    用Steve替换当前行出现的所有Bill
:%s#<[^>]\+>##g    删除所有HTMl标签，保留文本
dit   保留当前行html标签，删除文本
:%s/^\(.*\)\n\1$/\1/    Delete lines which appears twice
Ctrl+a    递增当前光标出的数字
Ctrl+x    递减当前光标处的数字
ggVGg?    将全文转换为rot13码，这是一种简单暗号语Rot13，重复执行此命令回复原样

# 大小写
Vu    当前行转换为小写
VU    当前行转换为大写，当然对中文无效
g~~    大小写置换
vEU    选择性的转换为大小，从光标起始处到
vE~    也是将选中的大写转小写，小写转大写。
ggguG    全文小写，其实我们可以拆分3个命令gg/gu/来记忆
:set ignorecase    搜索时忽略大小写
</pre>


自动补全
---------

以下命令都是在插入模式下执行。

<pre>
# 单词自动补全：

# 当你输入第一个字母的时候，再CTRL+n，自动出现下拉菜单，
# 单词默认选中第一个，继续CTRL+n，CTRL+p可以上下切换，或者用方向键（太慢）
CTRL+n ：

# 同上，只是默认的选中的是列表中最后一个单词
CTRL+p ：

# 行自动补全：

CTRL+x CTRL+l (l指小写的L )：两个命令组合使用。在插入模式下输入已经存在行的第一个单词，再按这两个键，就会列出该整行出来

文件名自动补全：

CTRL+x CTRL+f ：插入模式下，按这两个组合键，可以插入当前目录下的文件名。处用在哪里呢，当然是有时候我们要指定默认执行文件的路径，这样就方便啦。
字典补全：

首先在~/.vimrc加入如下代码，注意这是在Linux，windows下应该是C:\Users\$username(用户名）

    set dictionary-=$VIM/dic.txt dictionary+=$VIM/dic.txt

dic.txt中的单词一每行一个单词来分割的
CTRL+x CTRL+k 就能看到dic.txt中定义的单词的，如果你还麻烦，想直接CTRL+n就显示其中的列表的话，再配置一下.vimrc文件：

    set complete-=k complete+=k
</pre>

Vim寄存器
----------

先抛出一个问题：每次打开Vim，想找一段文本来练练手，于是打开网页copy了一段，问题来了，怎样粘贴到vim的编辑器里头去呢？如果你还在CTRL+v的话，说明你还无法割舍Windows，这里暂且告诉你如何粘贴：SHIFT+INSERT 两个键联合起来。再来看下面的原理 

寄存器是Vim用来存储文件的临时空间，当使用命令y（yank）或d（delete）复制删除文本时，该文本就会被保存在寄存器中，通过p（put）命令插入刚删除或复制的内容。vim的寄存器分为不同的种类：

数字寄存器

在normal模式下输入:reg，您是否看到很多“（双引号）开头的数字了呢，这些都是寄存器，（如果暂时没看到，那么在对文本做几个操作，比如：dd,yy等），这些寄存器里保存了最近删除的和复制的文本。

数字寄存器有十个，分别是："0，"1，"2... "9（注意：数字前有个双引号），寄存器"0保存上一次复制(y)操作的文本，"1到"9寄存器保存最近9次删除的文本行（注意这个“行”字），"1保存的内容是最最近一次删除的内容（也就是说最后一次执行删除命令保存的内容）"2保存的是倒数第二次删除的内容，依此类推，直到"9，如果又有新的操作，那么"9的内容将会被"8的内容替换，先前”9的内容将被丢弃。 

那么p（put）命令粘贴是哪个寄存器中的内容呢？有时候是粘贴的是"1寄存器的，有时粘贴的是"0寄存器中的，但是总的原则就是粘贴最近一次删除或者复制的内容，如果删除是最近的一次，就是粘贴"1的，也就是粘贴刚刚删除的文本，如果复制是最近的一次操作，那么粘贴的内容是"0中的，也就是粘贴刚刚复制的内容。

字母寄存器：

"a，"b，"c...都是字母寄存器，也许你执行:reg的时候看不到这些命令，不要紧，稍后就有了。之前粘贴我们用的都是p命令，如果我想粘贴其他寄存器里面的内容呢，你想到了吗？答案就是：寄存器的名称+p。现在我们新建一个字母寄存器，把当前三行保存到"a寄存器中去，具体操作如下：在normal模式下输入"a3yy，这样当前三行就保存在"a中去了，粘贴同样在normal模式下，"3p 即可。如果是大写字母的寄存器，如执行："Cdd：他的作用是把当前行删除，再把内容追加到"c寄存器中，也就是说字母寄存器没有大写之分，只是功能上有区别，大写就是追加，小写是替换。
其他寄存器：

""：无名寄存器，p命令粘贴的内容，保存最近一次删除或复制的内容。
“-：（-是个减号）小删除寄存器（small delete register），前面说过要您注意这个”行“字，也就是说并不是所有删除的文本都会保存在数字寄存器中，如果你删除的只是一个单词或字母： dw或者x，那么这个单词并不会保存在"1寄存器中，而是保存在"-寄存器里面。所有不包含换行符的删除都会保存在此寄存器中。

"* ：这个就是系统寄存器喽，最开始的问题的第二个答案知道了吧 

当然还有一些寄存器，这里就不一一介绍了。

缩进
-----

缩进在程序开发的时候是实用的一个功能，缩进的基本操作

<pre>
# normal 模式下：
>>  当前行增加缩进
<<  当前行减少缩进

# insert模式下：
CTRL+SHIFT+T：当前行增加缩进
CTRL+SHIFT+D：当前行减少缩进  
</pre>

默认vim的缩进宽度为8个空格，与缩进相关的参数有shiftwidth、tabstop、softtabstop、expandtab，相关操作有：

    * shiftwidth  reindent 操作（<<和>>）时缩进的列数（这里的一列相当于一个空格）
    * tabstop     一个tab键所占的列数，linux 内核代码建议每个tab占用8列
    * softtabstop 敲入tab键时实际占有的列数。
    * expandtab   输入tab时自动将其转化为空格

softtabstop大于tabstop时，且没有设置expandtab时，例如：softtabstop=12，tabstop=8，那么当输入一个tab时（softtabstop：实际占用的是12列），最后会变成一个tab（tabstop）加4个空格（8+4），输入两个tab（2个softtabstop：24列）会变成3个tab（tabstop），也就是说vim或用tabstop+空格来表示，最终你能看到的缩进的列数一定是softtabstop*按的tab键次数。（ps：:set list 可以查看tab符号）

softtabstop小于tabstop且没有设置expandtab时，如果softtabstop=4，tabstop=8，输入一个tab（softtabstop），会变成4个空格（因为不够用一个tabstop表示），输入两个tab会变成一个tab（8列）。

如果softtabstop等于tabstop，而且expandtab没有设置，softtabstop与tabstop就没什么区别了。

如果设置的expandtab，输入一个tab，将被展开成softtabstop值个空格，如果softtabstop=4，那么一个tab就会被替换成4个空格。

<pre>
:set shiftwidth=4

# 设置和取消expandtab:
:set expandtab
:set noexpandtab

# 查看tab和参数
:set list
:set nolist
:set $arg

# 自动缩进
:set autoindent   回车后自动缩进

# 通常Java的配置方式是：
:set softtabstop=4 shiftwidth=4 expandtab

# Linux kernel的配置方式：
:set tabstop=8 softtabstop=8 shiftwidth=8 noexpandtab
</pre>

正则表达式
-------------

|            | 匹配单个字符的元字符        |               |
|----------------------------------------------------|
| 元字符     | 名称                        | 描述          |
| .          | 点号                        | 匹配对单个任意字符   |
| [abc]      | 字符组                      |  匹配abc中的任一单个字符   |
| [^abc]     | 排除字符组                  | 匹配除abc之外的任意单个字符   |
| \char      | 转移字符                    | 匹配char对应的普通字符     |
|            | 提供计算功能的元字符        |        |
| ?          | 问号                        | 匹配一次或零次    |
| *          | 星号                        | 匹配零次或任意次   |
| +          | 加号                        | 匹配一次或任意次   |
| {min, max} | 匹配区间                    | 至少匹配min次，至多匹配max次 |
|            | 匹配位置的元字符            | |
| ^          |    脱字符                   | 匹配一行的开始处 |
| $          |   美元符                    | 匹配一行的结尾处 |
| \<         | 单词分界符                  | 匹配单词的开始位置 |
| \>         | 单词分界符                  | 匹配单词的结束位置 |
|            | 其他字符                    | |
| \          | 多选（竖线）                | 匹配任意分割的表达式  |
| ()         | 括号                        | 限定多选结构的范围  |
| \1  \2     | 反向引用                    | 匹配之前第一组括号、第二组括号中匹配的文本 |

